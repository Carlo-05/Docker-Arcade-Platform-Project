## **1.	Download git.Clone OIDC(directory) and images(directory) from the repository to local computer:**

```bash
    sudo apt update
    sudo apt install git -y 
    git clone --depth 1 https://github.com/Carlo-05/Docker-Arcade-Platform-Project.git
    cd Docker-Arcade-Platform-Project/
    mv terraform/OIDC ..
    mv images ..
    cd ../
    rm -rf Docker-Arcade-Platform-Project/
    ls
```
-   Example as shown in the image below:

    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_001.png?raw=true" alt="OIDC"style="width: 60%; height: auto;">
    </div>

-   *Note: We will use images directory later for building and pushing images to Docker Hub.*

## **2.	Explore and review OIDC:**
-	The directory contains main.tf, variables.tf, and output.tf.
-   Input the required information in the variables.tf as shown in the image:
-   Edit the region if you want deploy the project somewhere else. In my case, I'm using us-west-2.
    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_002.png?raw=true" alt="OIDC"style="width: 40%; height: auto;">
    </div>
-   For more information about OIDC configuration for AWS, visit this [website](https://docs.github.com/en/actions/how-tos/secure-your-work/security-harden-deployments/oidc-in-aws).
-   As for the thumbprint used in the configuration. Here is the [link](https://github.blog/changelog/2022-01-13-github-actions-update-on-oidc-based-deployments-to-aws/).
    -   The OIDC thumbprint is the hashed identifier of the IdPâ€™s SSL certificate. It ensures AWS trusts only the genuine GitHub OIDC provider when exchanging tokens for temporary credentials.

## **3.	Proceed applying the configuration:**
-	Before running any terraform commands, make sure you are inside the OIDC directory.
-   Initializes the OIDC directory and downloads the required provider plugins by executing this code:
```bash
    terraform init
```
-   Once the configuration has been initialized, the next step is to provision the infrastructure:
```bash
    terraform apply -auto-approve
```
-   Take note of the output **IAM role arn**. We will use it for Github Action configuration.
## **4.	Proceed to create repository secret and environmental secrets:**
-	Navigate through your forked repository in Github.
    
    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_003.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   Select **Actions** from Secrets and variables.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_2.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   Create a **new repository secret**.
    -   **Repository secrets** are secure credentials shared by all workflows in a repository.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_3.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

    -   Insert the **OIDC arn** as the value of IAM_ROLE_ARN from number 3. 

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_4.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   Create environment secret next.
-   **Environment secrets** are environment-specific credentials with added security controls for dev deployment.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_5.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   In order to create a environment secret, let's make dev environment first.

  
    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_6.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_7.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   Once the environment **dev** is created, let's add secret for this environment.

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_8.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-   Add private key that we created earlier. GitHub Actions need this key in order to ssh into the EC2 and execute commands to automate container production.
-   Obtain the the value of the private key first. Input this code into the local terminal.
  
```bash
    cat docker-key-example.pem
```
-   Output should look like the picture below:
  
    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_004.png?raw=true" alt="SecretsAndVariables "style="width: 20%; height: auto;">
    </div>

-   Copy and paste the **value** of the private key into the environment secret **EC2_SSH_KEY**.

    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_005.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>


### *Note: In GitHub Actions, the **names** of repository secrets, environment secrets, and repository/environment variables are normalized to uppercase. This means even if you define a variable name as ec2_ssh_key, GitHub will expose it as EC2_SSH_KEY when injected into the runtime environment.* ###

## **5. Create dev environment variables:**
-   Add environment variables.
    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_006.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

    <div align="left">
    <img src="https://github.com/Carlo-05/CI-CD-Github-Actions-Terraform-Project/blob/main/Other%20Documents/Picture/Secrets%20and%20variables_14.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

-  ### **dev** ###
    ```bash
        # Github Actions Workflow variables
        AWS_REGION = us-west-2
        BACKEND_BUCKET = <your-s3-bucket>
        BACKEND_KEY = DockerArcade/dev/terraform.tfstate
        BACKEND_REGION = us-west-2

        # VPC
        SELECT_REGION = west2
        VPC_CIDR_BLOCK = 10.0.0.0/16
        PUBLIC_SUBNET_COUNT = 1
        PRIVATE_SUBNET_COUNT = 0

        # EC2
        SELECT_AMI = ubuntu # choose between ubuntu & linux2
        INSTANCE_TYPE = t2.micro
        KEY_NAME = docker-key-example

        # Tags
        # Local tags
        ENV = dev
        PROJECTNAME = docker_arcade

        # VPC tags
        VPC_TAG = MyDockerVPC
        IGW_TAG = MyDockerIGW
        PUBLIC_SUBNET_TAG = public
        PRIVATE_SUBNET_TAG = private
        PUBLIC_RT_TAG = Public_Route_table
        PRIVATE_RT_TAG = Private_Route_table

        # SG tag
        EC2_PRACTICE_SGTAG = ec2_docker_SG
        # EC2 tag
        EC2_PRACTICE_TAG = ec2_docker
    ```


-   The environments should looked like the image below:
    <div align="left">
    <img src="https://github.com/Carlo-05/Docker-Arcade-Platform-Project/blob/main/documents/pictures/How%20to_007.png?raw=true" alt="SecretsAndVariables "style="width: 40%; height: auto;">
    </div>

